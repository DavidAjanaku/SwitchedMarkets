const cagr_calculator=new function(){document.querySelectorAll(".js_cagr-calc").forEach((e=>e.addEventListener("submit",(e=>{e.preventDefault();const t=e.currentTarget.id;const a=e.currentTarget;const s=document.getElementById("results-section");let n={};n.starting=parseInt(a.starting.value,10);if(t=="future-cagr"){n.percent=a.percent.value}else{n.ending=parseInt(a.ending.value,10)}if(t=="exact-cagr"){n.startDate=a.startDate.value;n.endDate=a.endDate.value}else{n.years=parseInt(a.years.value,10);n.months=parseInt(a.months.value,10);n.days=parseInt(a.days.value,10)}const l=cagr_calculator.validate_cagr_form(t,n);const r=document.querySelectorAll(".calc-err");if(l.valid){r.forEach((e=>{e.innerHTML="";e.style.display="none"}));s.classList.add("show");cagr_calculator.calculate_cagr(a,n);setTimeout((function(){document.getElementById("results-section-shortcut").scrollIntoView({behavior:"smooth"})}),500)}else{r.forEach((e=>{e.innerHTML=l.message;e.style.display="block"}))}}))));const e=document.getElementById("chart-container");let t={labels:[],datasets:[{label:"Value",data:[],backgroundColor:"#04d189"}]};let a={type:"bar",data:t,options:{layout:{padding:{bottom:0}},scales:{x:{title:{display:true,text:"Year"},grid:{display:true,drawBorder:false,drawOnChartArea:false,drawTicks:false}},y:{beginAtZero:true,grid:{display:true,drawBorder:false,drawOnChartArea:true,drawTicks:false}}},plugins:{title:{display:true,position:"top",text:"Investment Value By Year",font:{weight:"bold",size:18},padding:{top:10,bottom:30}},legend:{display:false}}}};let s;this.validate_cagr_form=(e,t)=>{let a={valid:true,message:""};if(e==="standard-cagr"){if(t.starting>=t.ending){a.valid=false;a.message="Starting value must be less than the ending value"}}else if(e==="exact-cagr"){const e=new Date(t.startDate).getTime();const s=new Date(t.endDate).getTime();if(e>=s){a.valid=false;a.message="Start date must be before the end date"}if(t.starting>=t.ending){a.valid=false;a.message="Starting value must be less than the ending value"}}return a};this.calculate_cagr=(t,a)=>{let s,n,l,r;if(t.id==="exact-cagr"){const e=new Date(a.startDate);const t=new Date(a.endDate);const r=(t.getTime()-e.getTime())/1e3;let o=Math.abs(Math.round(r/(3600*24)));s=o>=365?Math.floor(o/365):0;o=s?o-s*365:o;n=o>=30?Math.floor(o/30):0;o=n?Math.floor(o-n*30):o;l=o;a.years=s;a.months=n;a.days=l}if(t.id==="future-cagr"){r=a.percent;r=parseFloat((parseFloat(r)/100).toFixed(4))}else{r=(a.ending/a.starting)**(1/(a.years+a.months/12+a.days/365))-1}let o=[];let i=[];if(a.years===0){i.push(0);o.push(a.starting);const e=a.ending;const t=a.ending-o[o.length-1];i.push(t);o.push(e)}else{for(let e=0;e<a.years;e++){if(e===0){i.push(0);o.push(a.starting);let e=a.starting*r;let t=e+a.starting;i.push(e);o.push(t)}else{let t=o[e]*r;let a=t+o[e];i.push(t);o.push(a)}}}if(a.months>0&&a.years>0||a.days>0&&a.years>0){if(t.id!=="future-cagr"){const e=a.ending;const t=a.ending-o[o.length-1];i.push(t);o.push(e)}else{const e=o[o.length-1]*(r/2);const t=o[o.length-1]+e;i.push(e);o.push(t)}}this.update_time(r,i,o,a,t.id);this.update_cumulative(i,o,t.id);this.update_percentage(r);this.update_summary(r,a,i,o,t.id);if(e.$chartjs===undefined){this.new_chart(r,i,o,t.id)}else{this.update_chart(r,i,o,t.id)}};this.update_time=(e,t,a,s,n)=>{const l=Math.log(2)/Math.log(1+e);const r=l*365.2425;const o=this.calculate_time(r);const i=document.getElementById("time-table-body");const d=document.querySelectorAll("#time-table-body tr").length;for(let e=d-1;e>=0;e--){i.deleteRow(e)}for(const e in o){if(o.hasOwnProperty(e)){let t=i.insertRow();let a=t.insertCell(0);let s=t.insertCell(1);a.innerHTML=e.charAt(0).toUpperCase()+e.slice(1);s.innerHTML=o[e]}}};this.calculate_time=e=>{const t=e>=365?Math.floor(e/365):0;e=t?e-t*365:e;const a=e>=30?Math.floor(e/30):0;e=a?Math.floor(e-a*30):e;const s=e;return{years:t.toFixed(0),months:a.toFixed(0),days:s.toFixed(0)}};this.update_cumulative=(e,t,a)=>{const s=document.getElementById("cumulative-table-body");const n=document.querySelectorAll("#cumulative-table-body tr").length;for(let e=n-1;e>=0;e--){s.deleteRow(e)}for(let a=0;a<e.length;a++){let n=s.insertRow();let l=n.insertCell(0);let r=n.insertCell(1);let o=n.insertCell(2);let i=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e[a].toFixed(2));let d=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t[a].toFixed(2));if(a==e.length-1){l.innerHTML="Final"}else{l.innerHTML=a}r.innerHTML=i;o.innerHTML=d}};this.update_percentage=e=>{const t=document.getElementById("result-percent");const a=e*100;if(a>9999.99){t.innerHTML=(e*100).toPrecision(4)+"%";document.documentElement.style.setProperty("--percent-font","30px");document.getElementById("result-message").style.display="block"}else{t.innerHTML=(e*100).toFixed(2)+"%";document.documentElement.style.setProperty("--percent-font","40px");document.getElementById("result-message").style.display="none"}};this.update_summary=(e,t,a,s,n)=>{const l=document.getElementById("result-summary");let r;let o;const i=s[s.length-1];r=(new Date).getFullYear();if(t.years>0){const e=(new Date).setFullYear((new Date).getFullYear()+t.years);o=new Date(e).getFullYear()}else{o=r}let d="";let c="";if(t.months>0){d=", "+t.months+" month";if(t.months>1){d=", "+t.months+" months"}}if(t.days>0){c=", "+t.days+" day";if(t.days>1){c=", "+t.days+" days"}}const u="Below is a closer look at your annual growth rate. Assuming you have invested $"+t.starting.toFixed(2)+" in "+r+", the value of your investment would be $"+i.toFixed(2)+" in "+o+". Based on the CAGR formula, this represents a compound annual growth rate of "+(e*100).toFixed(2)+"% over a period of "+t.years+" years"+d+""+c+".";l.innerText=u};this.new_chart=(e,a,s,n)=>{for(let e=0;e<s.length;e++){if(e==s.length-1){t.labels.push("Final")}else{t.labels.push(e)}t.datasets[0].data.push(s[e])}this.init_chart()};this.update_chart=(e,a,n,l)=>{s.destroy();t.labels=[];t.datasets[0].data=[];for(let e=0;e<n.length;e++){if(e==n.length-1){t.labels.push("Final")}else{t.labels.push(e)}t.datasets[0].data.push(n[e])}this.init_chart()};this.init_chart=()=>{document.getElementById("chart-container").style.width="100%";document.getElementById("chart-container").style.height="auto";s=new Chart(document.getElementById("chart-container"),a)}};
