function Margin_calculator(){this.update_list_pairs=function(t){this.pairs=[];if(t){t.forEach((t=>{this.pairs[t.symbol]=t}))}this.calculator_html=new this.CalculatorHTML;this.calculator_html.update_pair_drop_down(this.pairs)};this.CalculatorHTML=function(){let t=this;this.instrument_field=document.getElementById("list-instruments");this.deposit_currency_field=document.getElementById("deposit-currency");this.lot_size_field=document.querySelector("#lot-size");this.leverage_field=document.querySelector("#account-leverage");this.instruments_drop_down=document.getElementById("drop-down-instruments");this.instrument_field.addEventListener("keyup",(function(){t.filter_instruments(t.instrument_field.value)}));this.instrument_field.addEventListener("click",(function(){t.filter_instruments("");t.instruments_drop_down.style.display="block"}));window.addEventListener("click",(function(e){if(!t.instrument_field.contains(e.target)){t.instruments_drop_down.style.display="none"}}));document.querySelector(".pip-calc-form").addEventListener("submit",(e=>{e.preventDefault();let i=new margin_calculator.MarginCalc(t.instrument_field.value,t.lot_size_field.value,this.deposit_currency_field.value,this.leverage_field.value);let n=i.calculate_margin();t.show_result(n)}));this.filter_instruments=function(t){let e=this.instruments_drop_down.children;for(let i=0;i<e.length;i++){let n=e[i].innerText;if(n.toLowerCase().includes(t.toLowerCase())){e[i].style.display="block"}else{e[i].style.display="none"}}};this.result_row=document.querySelector(".pip-value-result");this.margin_cell=this.result_row.querySelector(".js-margin");this.show_result=function(e){this.result_row.style.display="block";this.margin_cell.innerHTML=i(e);function i(e){let i=Math.round(e*100)/100;i=(new Intl.NumberFormat).format(i);return i+" "+t.deposit_currency_field.value}};this.update_pair_drop_down=function(t){let e=document.getElementById("list-instruments");let i=document.getElementById("drop-down-instruments");for(let n in t){let t=document.createElement("div");t.innerText=n;i.appendChild(t);t.onclick=function(){e.value=t.innerText;i.style.display="none"}}}};this.MarginCalc=function(t,e,i,n){this.list_pairs=margin_calculator.pairs;this.instrument=t;this.quote_curr=this.instrument.substring(3,6);this.base_curr=this.instrument.substring(0,3);this.lot_size=parseFloat(e);this.deposit_currency=i;this.leverage=parseInt(n);this.instrument_lot=1e5;this.calculate_pip_value=function(){let t=1e-4;if(this.quote_curr=="JPY"){t=.01}let e=this._calculate_exrate(this.quote_curr,this.deposit_currency);return this.instrument_lot*this.lot_size*t*e};this._calculate_exrate=function(t,e){if(t===e){return 1}let i=this._get_pair(t+e);let n=this._get_pair(e+t);if(i){return(parseFloat(i.bid)+parseFloat(i.ask))/2}else if(n){return 1/((parseFloat(n.bid)+parseFloat(n.ask))/2)}else{return this._calculate_ex_rate_via_usd(t,e)}};this._calculate_ex_rate_via_usd=function(t,e){let i=this._calculate_exrate(t,"USD");let n=this._calculate_exrate(e,"USD");return i/n};this._get_pair=function(t){let e=this.list_pairs[t];if(e){return e}else{return false}};this.calculate_margin=function(){let t=this._calculate_exrate(this.base_curr,this.deposit_currency);return t*this.lot_size*this.instrument_lot/this.leverage}}}
