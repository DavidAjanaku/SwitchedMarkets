function Swap_calculator(){this.update_list_pairs=function(t){this.pairs=[];if(t){t.forEach((t=>{this.pairs[t.symbol]=t}))}this.calculator_html=new this.CalculatorHTML;this.calculator_html.update_pair_drop_down(this.pairs)};this.update_swaps=function(t){this.list_swaps={};t.forEach((t=>{this.list_swaps[t.SYMBOL]={swap_long:t.swap_long,swap_short:t.swap_short}}))};this.CalculatorHTML=function(){let t=this;this.instrument_field=document.getElementById("list-instruments");this.deposit_currency_field=document.getElementById("deposit-currency");this.lot_size_field=document.querySelector("#lot-size");this.nights_number_field=document.querySelector("#nights-number");this.instruments_drop_down=document.getElementById("drop-down-instruments");this.instrument_field.addEventListener("keyup",(function(){t.filter_instruments(t.instrument_field.value)}));this.instrument_field.addEventListener("click",(function(){t.filter_instruments("");t.instruments_drop_down.style.display="block"}));window.addEventListener("click",(function(e){if(!t.instrument_field.contains(e.target)){t.instruments_drop_down.style.display="none"}}));document.querySelector(".pip-calc-form").addEventListener("submit",(e=>{e.preventDefault();let s=new swap_calculator.SwapCalc(t.instrument_field.value,t.lot_size_field.value,this.deposit_currency_field.value,this.nights_number_field.value);let i=s.calculate_swaps();t.show_result(i)}));this.filter_instruments=function(t){let e=this.instruments_drop_down.children;for(let s=0;s<e.length;s++){let i=e[s].innerText;if(i.toLowerCase().includes(t.toLowerCase())){e[s].style.display="block"}else{e[s].style.display="none"}}};this.result_row=document.querySelector(".pip-value-result");this.swap_long_cell=this.result_row.querySelector(".js-swap-long");this.swap_short_cell=this.result_row.querySelector(".js-swap-short");this.show_result=function(e){let s=n(e.swap_long);let i=n(e.swap_short);this.result_row.style.display="block";this.swap_long_cell.innerText=s;this.swap_short_cell.innerText=i;function n(e){let s=Math.round(e*100)/100;if(s>0){s="+"+s}return s+" "+t.deposit_currency_field.value}};this.update_pair_drop_down=function(t){let e=document.getElementById("list-instruments");let s=document.getElementById("drop-down-instruments");for(let i in t){let t=document.createElement("div");t.innerText=i;s.appendChild(t);t.onclick=function(){e.value=t.innerText;s.style.display="none"}}}};this.SwapCalc=function(t,e,s,i){this.list_pairs=swap_calculator.pairs;this.list_list_swaps=swap_calculator.list_swaps;this.instrument=t;this.quote_curr=this.instrument.substring(3,6);this.lot_size=parseFloat(e);this.deposit_currency=s;this.nights_number=parseInt(i);this.instrument_lot=1e5;this.calculate_pip_value=function(){let t=1e-4;if(this.quote_curr=="JPY"){t=.01}let e=this._calculate_exrate(this.quote_curr,this.deposit_currency);return this.instrument_lot*this.lot_size*t*e};this._calculate_exrate=function(t,e){if(t===e){return 1}let s=this._get_pair(t+e);let i=this._get_pair(e+t);if(s){return(parseFloat(s.bid)+parseFloat(s.ask))/2}else if(i){return 1/((parseFloat(i.bid)+parseFloat(i.ask))/2)}else{return this._calculate_ex_rate_via_usd(t,e)}};this._calculate_ex_rate_via_usd=function(t,e){let s=this._calculate_exrate(t,"USD");let i=this._calculate_exrate(e,"USD");return s/i};this._get_pair=function(t){let e=this.list_pairs[t];if(e){return e}else{return false}};this.calculate_swaps=function(){let t=this.calculate_pip_value();let e=this.list_list_swaps[this.instrument].swap_long*t/10*this.nights_number;let s=this.list_list_swaps[this.instrument].swap_short*t/10*this.nights_number;return{swap_long:e,swap_short:s}}}}
